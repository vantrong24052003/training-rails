<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rails: Model & ActiveRecord</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #cc0000;
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
        }
        
        .content-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #cc0000;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        h3 {
            color: #333;
            margin: 25px 0 15px;
        }
        
        p {
            margin-bottom: 15px;
        }
        
        ul,
        ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .code-block {
            background-color: #282c34;
            border-left: 4px solid #cc0000;
            padding: 16px;
            margin: 15px 0;
            overflow-x: auto;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .code-block pre {
            margin: 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.5;
            white-space: pre;
        }
        
        .code-block code {
            color: #abb2bf;
            font-size: 15px;
        }
        
        .keyword {
            color: #c678dd;
            /* t√≠m cho t·ª´ kh√≥a */
        }
        
        .class-name {
            color: #e5c07b;
            /* v√†ng cho t√™n class */
        }
        
        .method {
            color: #61afef;
            /* xanh d∆∞∆°ng cho methods */
        }
        
        .method-name {
            color: #98c379;
            /* xanh l√° cho t√™n method */
        }
        
        .symbol {
            color: #e06c75;
            /* ƒë·ªè nh·∫°t cho symbols */
        }
        
        .string {
            color: #98c379;
            /* xanh l√° cho strings */
        }
        
        .comment {
            color: #5c6370;
            /* x√°m cho comments */
            font-style: italic;
        }
        
        .number {
            color: #d19a66;
            /* cam cho numbers */
        }
        
        .boolean {
            color: #56b6c2;
            /* xanh ng·ªçc cho boolean */
        }
        
        .variable {
            color: #e06c75;
            /* ƒë·ªè nh·∫°t cho bi·∫øn */
        }
        
        .note {
            background-color: #e8f4fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        
        .tip {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
        }
        
        .command {
            display: inline-block;
            background-color: #f1f1f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            color: #cc0000;
        }
        
        .reference-links {
            list-style-type: none;
            padding-left: 0;
            margin: 20px 0;
        }
        
        .reference-links li {
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
        }
        
        .reference-links li:before {
            content: "üìö";
            position: absolute;
            left: 0;
            top: 0;
        }
        
        .reference-links a {
            color: #cc0000;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease, border-bottom 0.2s ease;
            border-bottom: 1px solid transparent;
        }
        
        .reference-links a:hover {
            color: #990000;
            border-bottom: 1px solid #990000;
        }
        
        .reference-links a:visited {
            color: #800000;
        }
        
        .practice-section {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .practice-section h3 {
            color: #cc0000;
            margin-top: 0;
        }
        
        .step {
            margin-bottom: 15px;
            padding-left: 30px;
            position: relative;
        }
        
        .step-number {
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background-color: #cc0000;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            header {
                padding: 20px 0;
            }
            h1 {
                font-size: 2rem;
            }
            .content-section {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Rails: Model & ActiveRecord</h1>
            <div class="subtitle">L√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu trong Rails</div>
        </header>

        <div class="content-section">
            <h2>1. Migration</h2>
            <p>Migration l√† c√°ch ƒë·ªÉ qu·∫£n l√Ω c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu trong Rails. Ch√∫ng cho ph√©p b·∫°n t·∫°o, s·ª≠a ƒë·ªïi v√† x√≥a b·∫£ng m·ªôt c√°ch c√≥ t·ªï ch·ª©c v√† c√≥ th·ªÉ ki·ªÉm so√°t phi√™n b·∫£n.</p>

            <h3>1.1. T·∫°o Migration</h3>
            <p>S·ª≠ d·ª•ng generator ƒë·ªÉ t·∫°o migration:</p>

            <div class="code-block">
                <pre><code><span class="comment"># T·∫°o b·∫£ng m·ªõi</span>
rails generate migration CreateProducts name:string description:text price:decimal

<span class="comment"># Th√™m c·ªôt v√†o b·∫£ng hi·ªán c√≥</span>
rails generate migration AddCategoryToProducts category:references

<span class="comment"># X√≥a c·ªôt</span>
rails generate migration RemoveDescriptionFromProducts description:text</code></pre>
            </div>

            <h3>1.2. C·∫•u tr√∫c Migration</h3>
            <p>M·ªói migration l√† m·ªôt class k·∫ø th·ª´a t·ª´ <code>ActiveRecord::Migration</code> v√† c√≥ c√°c ph∆∞∆°ng th·ª©c <code>up</code>/<code>down</code> ho·∫∑c <code>change</code>:</p>

            <div class="code-block">
                <pre><code><span class="keyword">class</span> <span class="class-name">CreateProducts</span> < <span class="class-name">ActiveRecord::Migration</span>[<span class="number">7.0</span>]
  <span class="keyword">def</span> <span class="method-name">change</span>
    <span class="method">create_table</span> <span class="symbol">:products</span> <span class="keyword">do</span> |<span class="variable">t</span>|
      <span class="variable">t</span>.<span class="method">string</span> <span class="symbol">:name</span>, <span class="symbol">null:</span> <span class="boolean">false</span>
      <span class="variable">t</span>.<span class="method">text</span> <span class="symbol">:description</span>
      <span class="variable">t</span>.<span class="method">decimal</span> <span class="symbol">:price</span>, <span class="symbol">precision:</span> <span class="number">10</span>, <span class="symbol">scale:</span> <span class="number">2</span>
      <span class="variable">t</span>.<span class="method">boolean</span> <span class="symbol">:active</span>, <span class="symbol">default:</span> <span class="boolean">true</span>
      <span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:category</span>, <span class="symbol">foreign_key:</span> <span class="boolean">true</span>

      <span class="variable">t</span>.<span class="method">timestamps</span>  <span class="comment"># T·∫°o created_at v√† updated_at</span>
    <span class="keyword">end</span>
    
    <span class="method">add_index</span> <span class="symbol">:products</span>, <span class="symbol">:name</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
            </div>

            <h3>1.3. C√°c ph∆∞∆°ng th·ª©c Migration ph·ªï bi·∫øn</h3>
            <ul>
                <li><code>create_table</code>: T·∫°o b·∫£ng m·ªõi</li>
                <li><code>add_column</code>: Th√™m c·ªôt v√†o b·∫£ng</li>
                <li><code>remove_column</code>: X√≥a c·ªôt kh·ªèi b·∫£ng</li>
                <li><code>rename_column</code>: ƒê·ªïi t√™n c·ªôt</li>
                <li><code>change_column</code>: Thay ƒë·ªïi ki·ªÉu d·ªØ li·ªáu c·ªßa c·ªôt</li>
                <li><code>add_index</code>: Th√™m index cho c·ªôt</li>
                <li><code>add_reference</code>: Th√™m kh√≥a ngo·∫°i</li>
                <li><code>add_timestamps</code>: Th√™m c·ªôt created_at v√† updated_at</li>
            </ul>

            <h3>1.4. Ch·∫°y v√† Rollback Migration</h3>
            <p>C√°c l·ªánh ƒë·ªÉ th·ª±c thi migration:</p>

            <div class="code-block">
                <pre><code><span class="comment"># Ch·∫°y t·∫•t c·∫£ migration ch∆∞a ƒë∆∞·ª£c th·ª±c thi</span>
rails db:migrate

<span class="comment"># Rollback migration cu·ªëi c√πng</span>
rails db:rollback

<span class="comment"># Rollback nhi·ªÅu b∆∞·ªõc</span>
rails db:rollback STEP=3

<span class="comment"># Ch·∫°y migration ƒë·∫øn m·ªôt phi√™n b·∫£n c·ª• th·ªÉ</span>
rails db:migrate VERSION=20230101120000

<span class="comment"># Reset database (drop, create, migrate)</span>
rails db:reset</code></pre>
            </div>

            <div class="note">
                <strong>L∆∞u √Ω:</strong> Migration l√† c√°ch an to√†n ƒë·ªÉ thay ƒë·ªïi c·∫•u tr√∫c database m√† kh√¥ng l√†m m·∫•t d·ªØ li·ªáu. Lu√¥n ki·ªÉm tra k·ªπ tr∆∞·ªõc khi ch·∫°y migration tr√™n m√¥i tr∆∞·ªùng production.
            </div>
        </div>

        <div class="content-section">
            <h2>2. Model</h2>
            <p>Model trong Rails l√† l·ªõp Ruby ƒë·∫°i di·ªán cho m·ªôt b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu v√† cung c·∫•p c√°c ph∆∞∆°ng th·ª©c ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi d·ªØ li·ªáu.</p>

            <h3>2.1. T·∫°o Model</h3>
            <p>S·ª≠ d·ª•ng generator ƒë·ªÉ t·∫°o model:</p>

            <div class="code-block">
                <pre><code>rails generate model Product name:string description:text price:decimal:10,2 active:boolean</code></pre>
            </div>

            <p>L·ªánh n√†y s·∫Ω t·∫°o:</p>
            <ul>
                <li>File model <code>app/models/product.rb</code></li>
                <li>File migration ƒë·ªÉ t·∫°o b·∫£ng <code>products</code></li>
                <li>File test cho model</li>
            </ul>

            <h3>2.2. C·∫•u tr√∫c Model c∆° b·∫£n</h3>

            <div class="code-block">
                <pre><code><span class="keyword">class</span> <span class="class-name">Product</span> < <span class="class-name">ApplicationRecord</span>
  <span class="comment"># Associations</span>
  <span class="method">belongs_to</span> <span class="symbol">:category</span>
  <span class="method">has_many</span> <span class="symbol">:order_items</span>
  <span class="method">has_many</span> <span class="symbol">:orders</span>, <span class="symbol">through:</span> <span class="symbol">:order_items</span>
  
  <span class="comment"># Validations</span>
  <span class="method">validates</span> <span class="symbol">:name</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>, <span class="symbol">uniqueness:</span> <span class="boolean">true</span>
  <span class="method">validates</span> <span class="symbol">:price</span>, <span class="symbol">numericality:</span> { <span class="symbol">greater_than:</span> <span class="number">0</span> }
  
  <span class="comment"># Callbacks</span>
  <span class="method">before_save</span> <span class="symbol">:normalize_name</span>
  
  <span class="comment"># Scopes</span>
  <span class="method">scope</span> <span class="symbol">:active</span>, -> { <span class="method">where</span>(<span class="symbol">active:</span> <span class="boolean">true</span>) }
  <span class="method">scope</span> <span class="symbol">:price_below</span>, ->(amount) { <span class="method">where</span>(<span class="string">'price < ?'</span>, amount) }
  
  <span class="comment"># Instance methods</span>
  <span class="keyword">def</span> <span class="method-name">discount_price</span>(percentage)
    <span class="variable">price</span> * (<span class="number">1</span> - percentage / <span class="number">100.0</span>)
  <span class="keyword">end</span>
  
  <span class="keyword">private</span>
  
  <span class="keyword">def</span> <span class="method-name">normalize_name</span>
    <span class="variable">self</span>.<span class="variable">name</span> = <span class="variable">name</span>.<span class="method">strip</span>.<span class="method">titleize</span> <span class="keyword">if</span> <span class="variable">name</span>.<span class="method">present?</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
            </div>

            <h3>2.3. CRUD Operations</h3>
            <p>ActiveRecord cung c·∫•p c√°c ph∆∞∆°ng th·ª©c ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c CRUD (Create, Read, Update, Delete):</p>

            <div class="code-block">
                <pre><code><span class="comment"># Create</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">create</span>(<span class="symbol">name:</span> <span class="string">'Laptop'</span>, <span class="symbol">price:</span> <span class="number">999.99</span>)

<span class="comment"># ho·∫∑c</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">new</span>(<span class="symbol">name:</span> <span class="string">'Laptop'</span>, <span class="symbol">price:</span> <span class="number">999.99</span>)
<span class="variable">product</span>.<span class="method">save</span>

<span class="comment"># Read</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">find</span>(<span class="number">1</span>)                <span class="comment"># T√¨m theo ID</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">find_by</span>(<span class="symbol">name:</span> <span class="string">'Laptop'</span>)  <span class="comment"># T√¨m theo ƒëi·ªÅu ki·ªán</span>
<span class="variable">products</span> = <span class="class-name">Product</span>.<span class="method">where</span>(<span class="symbol">active:</span> <span class="boolean">true</span>)  <span class="comment"># T√¨m nhi·ªÅu b·∫£n ghi</span>
<span class="variable">products</span> = <span class="class-name">Product</span>.<span class="method">all</span>                   <span class="comment"># L·∫•y t·∫•t c·∫£</span>

<span class="comment"># Update</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">find</span>(<span class="number">1</span>)
<span class="variable">product</span>.<span class="method">update</span>(<span class="symbol">price:</span> <span class="number">899.99</span>)

<span class="comment"># ho·∫∑c</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">find</span>(<span class="number">1</span>)
<span class="variable">product</span>.<span class="variable">price</span> = <span class="number">899.99</span>
<span class="variable">product</span>.<span class="method">save</span>

<span class="comment"># Delete</span>
<span class="variable">product</span> = <span class="class-name">Product</span>.<span class="method">find</span>(<span class="number">1</span>)
<span class="variable">product</span>.<span class="method">destroy</span>

<span class="comment"># ho·∫∑c</span>
<span class="class-name">Product</span>.<span class="method">destroy</span>(<span class="number">1</span>)</code></pre>
            </div>

            <h3>2.4. Query Interface</h3>
            <p>ActiveRecord cung c·∫•p m·ªôt interface m·∫°nh m·∫Ω ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu:</p>

            <div class="code-block">
                <pre><code><span class="comment"># Filtering</span>
<span class="class-name">Product</span>.<span class="method">where</span>(<span class="symbol">active:</span> <span class="boolean">true</span>, <span class="symbol">category_id:</span> <span class="number">1</span>)
<span class="class-name">Product</span>.<span class="method">where</span>(<span class="string">'price > ?'</span>, <span class="number">100</span>)
<span class="class-name">Product</span>.<span class="method">where</span>(<span class="symbol">name:</span> [<span class="string">'Laptop'</span>, <span class="string">'Phone'</span>])

<span class="comment"># Ordering</span>
<span class="class-name">Product</span>.<span class="method">order</span>(<span class="symbol">price:</span> <span class="symbol">:desc</span>)
<span class="class-name">Product</span>.<span class="method">order</span>(<span class="symbol">created_at:</span> <span class="symbol">:asc</span>)

<span class="comment"># Limit & Offset</span>
<span class="class-name">Product</span>.<span class="method">limit</span>(<span class="number">10</span>)
<span class="class-name">Product</span>.<span class="method">offset</span>(<span class="number">10</span>).<span class="method">limit</span>(<span class="number">10</span>)  <span class="comment"># Ph√¢n trang</span>

<span class="comment"># Selecting specific columns</span>
<span class="class-name">Product</span>.<span class="method">select</span>(<span class="symbol">:id</span>, <span class="symbol">:name</span>, <span class="symbol">:price</span>)

<span class="comment"># Grouping</span>
<span class="class-name">Product</span>.<span class="method">group</span>(<span class="symbol">:category_id</span>).<span class="method">count</span>

<span class="comment"># Joining</span>
<span class="class-name">Product</span>.<span class="method">joins</span>(<span class="symbol">:category</span>).<span class="method">where</span>(<span class="string">'categories.name = ?'</span>, <span class="string">'Electronics'</span>)

<span class="comment"># Eager loading (N+1 query problem)</span>
<span class="class-name">Product</span>.<span class="method">includes</span>(<span class="symbol">:category</span>, <span class="symbol">:reviews</span>)</code></pre>
            </div>

            <div class="tip">
                <strong>M·∫πo:</strong> S·ª≠ d·ª•ng <code>includes</code> ƒë·ªÉ tr√°nh v·∫•n ƒë·ªÅ N+1 query khi b·∫°n c·∫ßn truy c·∫≠p c√°c association trong v√≤ng l·∫∑p.
            </div>
        </div>

        <div class="content-section">
            <h2>3. Association</h2>
            <p>Associations ƒë·ªãnh nghƒ©a m·ªëi quan h·ªá gi·ªØa c√°c model trong Rails.</p>

            <h3>3.1. C√°c lo·∫°i Association</h3>

            <div class="code-block">
                <pre><code><span class="comment"># 1. belongs_to - Quan h·ªá N-1</span>
<span class="keyword">class</span> <span class="class-name">Post</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:user</span>  <span class="comment"># M·ªôt b√†i vi·∫øt thu·ªôc v·ªÅ m·ªôt ng∆∞·ªùi d√πng</span>
  <span class="method">belongs_to</span> <span class="symbol">:category</span>, <span class="symbol">optional:</span> <span class="boolean">true</span>  <span class="comment"># C√≥ th·ªÉ kh√¥ng c√≥ category</span>
<span class="keyword">end</span>

<span class="comment"># 2. has_one - Quan h·ªá 1-1</span>
<span class="keyword">class</span> <span class="class-name">User</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_one</span> <span class="symbol">:profile</span>  <span class="comment"># M·ªôt ng∆∞·ªùi d√πng c√≥ m·ªôt h·ªì s∆°</span>
  <span class="method">has_one</span> <span class="symbol">:address</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>  <span class="comment"># X√≥a ƒë·ªãa ch·ªâ khi x√≥a user</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Profile</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:user</span>
<span class="keyword">end</span>

<span class="comment"># 3. has_many - Quan h·ªá 1-N</span>
<span class="keyword">class</span> <span class="class-name">User</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:posts</span>  <span class="comment"># M·ªôt ng∆∞·ªùi d√πng c√≥ nhi·ªÅu b√†i vi·∫øt</span>
  <span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>  <span class="comment"># X√≥a t·∫•t c·∫£ comments khi x√≥a user</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Category</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:posts</span>
<span class="keyword">end</span>

<span class="comment"># 4. has_many :through - Quan h·ªá N-N v·ªõi model trung gian</span>
<span class="keyword">class</span> <span class="class-name">Doctor</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:appointments</span>
  <span class="method">has_many</span> <span class="symbol">:patients</span>, <span class="symbol">through:</span> <span class="symbol">:appointments</span>  <span class="comment"># B√°c sƒ© c√≥ nhi·ªÅu b·ªánh nh√¢n th√¥ng qua appointments</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Appointment</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:doctor</span>
  <span class="method">belongs_to</span> <span class="symbol">:patient</span>
  
  <span class="comment"># C√≥ th·ªÉ th√™m c√°c thu·ªôc t√≠nh nh∆∞ ng√†y h·∫πn, ghi ch√∫, v.v.</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Patient</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:appointments</span>
  <span class="method">has_many</span> <span class="symbol">:doctors</span>, <span class="symbol">through:</span> <span class="symbol">:appointments</span>  <span class="comment"># B·ªánh nh√¢n c√≥ nhi·ªÅu b√°c sƒ© th√¥ng qua appointments</span>
<span class="keyword">end</span>

<span class="comment"># 5. has_one :through - Quan h·ªá 1-1 th√¥ng qua model trung gian</span>
<span class="keyword">class</span> <span class="class-name">Supplier</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_one</span> <span class="symbol">:account</span>
  <span class="method">has_one</span> <span class="symbol">:account_history</span>, <span class="symbol">through:</span> <span class="symbol">:account</span>  <span class="comment"># Truy c·∫≠p tr·ª±c ti·∫øp ƒë·∫øn l·ªãch s·ª≠ t√†i kho·∫£n</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Account</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:supplier</span>
  <span class="method">has_one</span> <span class="symbol">:account_history</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">AccountHistory</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:account</span>
<span class="keyword">end</span>

<span class="comment"># 6. Polymorphic Association - Quan h·ªá ƒëa h√¨nh</span>
<span class="keyword">class</span> <span class="class-name">Comment</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:commentable</span>, <span class="symbol">polymorphic:</span> <span class="boolean">true</span>  <span class="comment"># Comment c√≥ th·ªÉ thu·ªôc v·ªÅ nhi·ªÅu lo·∫°i ƒë·ªëi t∆∞·ª£ng kh√°c nhau</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Post</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">as:</span> <span class="symbol">:commentable</span>  <span class="comment"># Post c√≥ th·ªÉ c√≥ nhi·ªÅu comments</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Product</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">as:</span> <span class="symbol">:commentable</span>  <span class="comment"># Product c≈©ng c√≥ th·ªÉ c√≥ nhi·ªÅu comments</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Video</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">as:</span> <span class="symbol">:commentable</span>  <span class="comment"># Video c≈©ng c√≥ th·ªÉ c√≥ nhi·ªÅu comments</span>
<span class="keyword">end</span></code></pre>
            </div>

            <h3>3.2. T√πy ch·ªçn Association</h3>
            <p>C√°c t√πy ch·ªçn ph·ªï bi·∫øn khi ƒë·ªãnh nghƒ©a association:</p>

            <div class="code-block">
                <pre><code><span class="comment"># dependent: x√°c ƒë·ªãnh h√†nh vi khi x√≥a ƒë·ªëi t∆∞·ª£ng cha</span>
<span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>  <span class="comment"># X√≥a t·∫•t c·∫£ comments khi x√≥a post</span>

<span class="comment"># foreign_key: ch·ªâ ƒë·ªãnh t√™n kh√≥a ngo·∫°i</span>
<span class="method">belongs_to</span> <span class="symbol">:author</span>, <span class="symbol">class_name:</span> <span class="string">'User'</span>, <span class="symbol">foreign_key:</span> <span class="string">'user_id'</span>

<span class="comment"># class_name: ch·ªâ ƒë·ªãnh t√™n class khi kh√°c v·ªõi quy ∆∞·ªõc</span>
<span class="method">has_many</span> <span class="symbol">:authored_posts</span>, <span class="symbol">class_name:</span> <span class="string">'Post'</span>, <span class="symbol">foreign_key:</span> <span class="string">'author_id'</span>

<span class="comment"># through: ƒë·ªãnh nghƒ©a quan h·ªá many-to-many</span>
<span class="method">has_many</span> <span class="symbol">:categories</span>, <span class="symbol">through:</span> <span class="symbol">:product_categories</span>

<span class="method">belongs_to</span> <span class="symbol">:post</span>, <span class="symbol">counter_cache:</span> <span class="symbol">:comments_count</span>

<span class="comment"># optional: cho ph√©p association l√† nil</span>
<span class="method">belongs_to</span> <span class="symbol">:supervisor</span>, <span class="symbol">class_name:</span> <span class="string">'User'</span>, <span class="symbol">optional:</span> <span class="boolean">true</span>

<span class="comment"># inverse_of: x√°c ƒë·ªãnh m·ªëi quan h·ªá ng∆∞·ª£c l·∫°i</span>
<span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">inverse_of:</span> <span class="symbol">:post</span>
<span class="method">belongs_to</span> <span class="symbol">:post</span>, <span class="symbol">inverse_of:</span> <span class="symbol">:comments</span></code></pre>
            </div>

            <h3>3.3. S·ª≠ d·ª•ng Association</h3>
            <p>Sau khi ƒë·ªãnh nghƒ©a association, Rails cung c·∫•p nhi·ªÅu ph∆∞∆°ng th·ª©c ƒë·ªÉ l√†m vi·ªác v·ªõi ch√∫ng:</p>

            <div class="code-block">
                <pre><code><span class="comment"># Truy c·∫≠p association</span>
<span class="variable">user</span> = <span class="class-name">User</span>.<span class="method">first</span>
<span class="variable">user</span>.<span class="variable">posts</span>  <span class="comment"># => Tr·∫£ v·ªÅ t·∫•t c·∫£ b√†i vi·∫øt c·ªßa user</span>

<span class="comment"># Th√™m ƒë·ªëi t∆∞·ª£ng v√†o collection</span>
<span class="variable">post</span> = <span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">create</span>(<span class="symbol">title:</span> <span class="string">'New Post'</span>, <span class="symbol">content:</span> <span class="string">'Content...'</span>)
<span class="variable">user</span>.<span class="variable">posts</span> << <span class="class-name">Post</span>.<span class="method">new</span>(<span class="symbol">title:</span> <span class="string">'Another Post'</span>)

<span class="comment"># X√≥a ƒë·ªëi t∆∞·ª£ng kh·ªèi collection</span>
<span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">delete</span>(<span class="variable">post</span>)

<span class="comment"># X√≥a t·∫•t c·∫£ ƒë·ªëi t∆∞·ª£ng trong collection</span>
<span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">clear</span>

<span class="comment"># ƒê·∫øm s·ªë l∆∞·ª£ng ƒë·ªëi t∆∞·ª£ng</span>
<span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">count</span>

<span class="comment"># Ki·ªÉm tra s·ª± t·ªìn t·∫°i</span>
<span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">exists?</span>(<span class="symbol">title:</span> <span class="string">'New Post'</span>)

<span class="comment"># T√¨m ki·∫øm trong association</span>
<span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">find_by</span>(<span class="symbol">published:</span> <span class="boolean">true</span>)

<span class="comment"># T·∫°o ƒë·ªëi t∆∞·ª£ng li√™n k·∫øt</span>
<span class="variable">comment</span> = <span class="variable">post</span>.<span class="variable">comments</span>.<span class="method">build</span>(<span class="symbol">content:</span> <span class="string">'Great post!'</span>)  <span class="comment"># Ch∆∞a l∆∞u v√†o DB</span>
<span class="variable">comment</span> = <span class="variable">post</span>.<span class="variable">comments</span>.<span class="method">create</span>(<span class="symbol">content:</span> <span class="string">'Great post!'</span>)  <span class="comment"># ƒê√£ l∆∞u v√†o DB</span></code></pre>
            </div>
            <h3>3.4. Eager Loading</h3>
            <p>Eager loading gi√∫p gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ N+1 query khi l√†m vi·ªác v·ªõi association:</p>

            <div class="code-block">
                <pre><code><span class="comment"># V·∫•n ƒë·ªÅ N+1 query</span>
<span class="variable">posts</span> = <span class="class-name">Post</span>.<span class="method">all</span>
<span class="variable">posts</span>.<span class="method">each</span> <span class="keyword">do</span> |<span class="variable">post</span>|
  <span class="method">puts</span> <span class="variable">post</span>.<span class="variable">user</span>.<span class="variable">name</span>  <span class="comment"># M·ªói l·∫ßn truy c·∫≠p post.user s·∫Ω t·∫°o m·ªôt query m·ªõi</span>
<span class="keyword">end</span>

<span class="comment"># Gi·∫£i ph√°p: S·ª≠ d·ª•ng includes</span>
<span class="variable">posts</span> = <span class="class-name">Post</span>.<span class="method">includes</span>(<span class="symbol">:user</span>)
<span class="variable">posts</span>.<span class="method">each</span> <span class="keyword">do</span> |<span class="variable">post</span>|
  <span class="method">puts</span> <span class="variable">post</span>.<span class="variable">user</span>.<span class="variable">name</span>  <span class="comment"># Kh√¥ng t·∫°o th√™m query</span>
<span class="keyword">end</span>

<span class="comment"># Eager loading nhi·ªÅu association</span>
<span class="variable">posts</span> = <span class="class-name">Post</span>.<span class="method">includes</span>(<span class="symbol">:user</span>, <span class="symbol">:comments</span>, <span class="symbol">:tags</span>)

<span class="comment"># Eager loading nested association</span>
<span class="variable">posts</span> = <span class="class-name">Post</span>.<span class="method">includes</span>(<span class="symbol">comments:</span> <span class="symbol">:user</span>)</code></pre>
            </div>

            <div class="note">
                <strong>L∆∞u √Ω:</strong> Ngo√†i <code>includes</code>, Rails c√≤n cung c·∫•p <code>preload</code> v√† <code>eager_load</code> v·ªõi c√°c c√°ch th·ª±c hi·ªán eager loading kh√°c nhau. <code>includes</code> s·∫Ω t·ª± ƒë·ªông ch·ªçn ph∆∞∆°ng ph√°p ph√π h·ª£p.
            </div>

            <h3>3.5. Association Callbacks</h3>
            <p>Rails cung c·∫•p c√°c callback ƒë·∫∑c bi·ªát cho association:</p>

            <div class="code-block">
                <pre><code><span class="keyword">class</span> <span class="class-name">Post</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>
  
  <span class="comment"># Callbacks khi th√™m/x√≥a comment</span>
  <span class="method">before_add</span> <span class="symbol">:check_comment_limit</span>
  <span class="method">after_add</span> <span class="symbol">:notify_subscribers</span>
  <span class="method">before_remove</span> <span class="symbol">:archive_comment</span>
  
  <span class="keyword">private</span>
  
  <span class="keyword">def</span> <span class="method-name">check_comment_limit</span>(comment)
    <span class="keyword">if</span> <span class="variable">comments</span>.<span class="method">count</span> >= <span class="number">100</span>
      <span class="keyword">throw</span> <span class="symbol">:abort</span>  <span class="comment"># NgƒÉn kh√¥ng cho th√™m comment</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  
  <span class="keyword">def</span> <span class="method-name">notify_subscribers</span>(comment)
    <span class="comment"># G·ª≠i th√¥ng b√°o cho ng∆∞·ªùi ƒëƒÉng k√Ω</span>
  <span class="keyword">end</span>
  
  <span class="keyword">def</span> <span class="method-name">archive_comment</span>(comment)
    <span class="comment"># L∆∞u tr·ªØ comment tr∆∞·ªõc khi x√≥a</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
            </div>

            <h3>3.6. Self-referential Association</h3>
            <p>M·ªôt model c√≥ th·ªÉ c√≥ association v·ªõi ch√≠nh n√≥:</p>

            <div class="code-block">
                <pre><code><span class="keyword">class</span> <span class="class-name">Employee</span> < <span class="class-name">ApplicationRecord</span>
  <span class="method">belongs_to</span> <span class="symbol">:manager</span>, <span class="symbol">class_name:</span> <span class="string">'Employee'</span>, <span class="symbol">optional:</span> <span class="boolean">true</span>
  <span class="method">has_many</span> <span class="symbol">:subordinates</span>, <span class="symbol">class_name:</span> <span class="string">'Employee'</span>, <span class="symbol">foreign_key:</span> <span class="string">'manager_id'</span>
<span class="keyword">end</span>

<span class="comment"># S·ª≠ d·ª•ng</span>
<span class="variable">manager</span> = <span class="class-name">Employee</span>.<span class="method">find</span>(<span class="number">1</span>)
<span class="variable">manager</span>.<span class="variable">subordinates</span>  <span class="comment"># Nh√¢n vi√™n d∆∞·ªõi quy·ªÅn</span>

<span class="variable">employee</span> = <span class="class-name">Employee</span>.<span class="method">find</span>(<span class="number">2</span>)
<span class="variable">employee</span>.<span class="variable">manager</span>  <span class="comment"># Ng∆∞·ªùi qu·∫£n l√Ω</span></code></pre>
            </div>

            <div class="tip">
                <strong>M·∫πo:</strong> Khi thi·∫øt k·∫ø database, h√£y c√¢n nh·∫Øc k·ªπ c√°c m·ªëi quan h·ªá gi·ªØa c√°c b·∫£ng. Association ƒë√∫ng s·∫Ω gi√∫p code d·ªÖ ƒë·ªçc v√† hi·ªáu qu·∫£ h∆°n.
            </div>


            <div class="content-section">
                <h2>4. Validation</h2>
                <p>Validation gi√∫p ƒë·∫£m b·∫£o d·ªØ li·ªáu h·ª£p l·ªá tr∆∞·ªõc khi l∆∞u v√†o c∆° s·ªü d·ªØ li·ªáu. Rails cung c·∫•p nhi·ªÅu ph∆∞∆°ng th·ª©c validation t√≠ch h·ª£p s·∫µn.</p>

                <h3>4.1. C√°c validation ph·ªï bi·∫øn</h3>

                <div class="code-block">
                    <pre><code><span class="keyword">class</span> <span class="class-name">User</span> < <span class="class-name">ApplicationRecord</span>
<span class="comment"># Ki·ªÉm tra s·ª± hi·ªán di·ªán c·ªßa tr∆∞·ªùng</span>
<span class="method">validates</span> <span class="symbol">:name</span>, <span class="symbol">:email</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>

<span class="comment"># Ki·ªÉm tra t√≠nh duy nh·∫•t</span>
<span class="method">validates</span> <span class="symbol">:email</span>, <span class="symbol">uniqueness:</span> { <span class="symbol">case_sensitive:</span> <span class="boolean">false</span> }

<span class="comment"># Ki·ªÉm tra ƒë·ªô d√†i</span>
<span class="method">validates</span> <span class="symbol">:password</span>, <span class="symbol">length:</span> { <span class="symbol">minimum:</span> <span class="number">8</span>, <span class="symbol">maximum:</span> <span class="number">72</span> }

<span class="comment"># Ki·ªÉm tra ƒë·ªãnh d·∫°ng v·ªõi regex</span>
<span class="method">validates</span> <span class="symbol">:email</span>, <span class="symbol">format:</span> { <span class="symbol">with:</span> <span class="regexp">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span> }

<span class="comment"># Ki·ªÉm tra gi√° tr·ªã s·ªë</span>
<span class="method">validates</span> <span class="symbol">:age</span>, <span class="symbol">numericality:</span> { <span class="symbol">greater_than_or_equal_to:</span> <span class="number">18</span>, <span class="symbol">only_integer:</span> <span class="boolean">true</span> }

<span class="comment"># Ki·ªÉm tra gi√° tr·ªã trong danh s√°ch</span>
<span class="method">validates</span> <span class="symbol">:status</span>, <span class="symbol">inclusion:</span> { <span class="symbol">in:</span> [<span class="string">'active'</span>, <span class="string">'inactive'</span>, <span class="string">'pending'</span>] }

<span class="comment"># Ki·ªÉm tra gi√° tr·ªã kh√¥ng n·∫±m trong danh s√°ch</span>
<span class="method">validates</span> <span class="symbol">:username</span>, <span class="symbol">exclusion:</span> { <span class="symbol">in:</span> [<span class="string">'admin'</span>, <span class="string">'superuser'</span>] }

<span class="comment"># Validation c√≥ ƒëi·ªÅu ki·ªán</span>
<span class="method">validates</span> <span class="symbol">:card_number</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>, <span class="symbol">if:</span> <span class="symbol">:paid_with_card?</span>

<span class="comment"># Validation t√πy ch·ªânh</span>
<span class="method">validate</span> <span class="symbol">:check_expiration_date</span>

<span class="keyword">private</span>

<span class="keyword">def</span> <span class="method-name">paid_with_card?</span>
  <span class="variable">payment_method</span> == <span class="string">'card'</span>
<span class="keyword">end</span>

<span class="keyword">def</span> <span class="method-name">check_expiration_date</span>
  <span class="keyword">if</span> <span class="variable">expiration_date</span>.<span class="method">present?</span> && <span class="variable">expiration_date</span> < <span class="class-name">Date</span>.<span class="method">today</span>
    <span class="variable">errors</span>.<span class="method">add</span>(<span class="symbol">:expiration_date</span>, <span class="string">"can't be in the past"</span>)
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
                </div>

                <h3>4.2. Ki·ªÉm tra validation</h3>
                <p>C√°c ph∆∞∆°ng th·ª©c ƒë·ªÉ ki·ªÉm tra v√† x·ª≠ l√Ω validation:</p>

                <div class="code-block">
                    <pre><code><span class="comment"># Ki·ªÉm tra ƒë·ªëi t∆∞·ª£ng c√≥ h·ª£p l·ªá kh√¥ng</span>
<span class="variable">user</span> = <span class="class-name">User</span>.<span class="method">new</span>(<span class="symbol">email:</span> <span class="string">'invalid'</span>)
<span class="variable">user</span>.<span class="method">valid?</span>  <span class="comment"># => false</span>

<span class="comment"># Truy c·∫≠p danh s√°ch l·ªói</span>
<span class="variable">user</span>.<span class="variable">errors</span>.<span class="method">full_messages</span>  <span class="comment"># => ["Email is invalid", "Name can't be blank"]</span>

<span class="comment"># Ki·ªÉm tra l·ªói c·ªßa m·ªôt tr∆∞·ªùng c·ª• th·ªÉ</span>
<span class="variable">user</span>.<span class="variable">errors</span>[<span class="symbol">:email</span>]  <span class="comment"># => ["is invalid"]</span>

<span class="comment"># L∆∞u b·ªè qua validation</span>
<span class="variable">user</span>.<span class="method">save</span>(<span class="symbol">validate:</span> <span class="boolean">false</span>)

<span class="comment"># L∆∞u v√† n√©m ngo·∫°i l·ªá n·∫øu kh√¥ng h·ª£p l·ªá</span>
<span class="variable">user</span>.<span class="method">save!</span></code></pre>
                </div>

                <div class="note">
                    <strong>L∆∞u √Ω:</strong> Validation ch·ªâ ƒë∆∞·ª£c k√≠ch ho·∫°t khi g·ªçi <code>save</code>, <code>create</code>, <code>update</code>, ho·∫∑c <code>valid?</code>. C√°c ph∆∞∆°ng th·ª©c nh∆∞ <code>update_column</code>, <code>update_columns</code>, ho·∫∑c
                    <code>save(validate: false)</code> s·∫Ω b·ªè qua validation.
                </div>
            </div>

            <div class="content-section">
                <h2>5. Reference</h2>
                <p>Reference trong Rails l√† c√°ch ƒë·ªÉ t·∫°o m·ªëi quan h·ªá gi·ªØa c√°c b·∫£ng th√¥ng qua kh√≥a ngo·∫°i (foreign key).</p>

                <h3>5.1. T·∫°o Reference trong Migration</h3>

                <div class="code-block">
                    <pre><code><span class="comment"># T·∫°o b·∫£ng v·ªõi reference</span>
rails generate migration CreateComments content:text post:references user:references

<span class="comment"># Th√™m reference v√†o b·∫£ng hi·ªán c√≥</span>
rails generate migration AddCategoryToProducts category:references</code></pre>
                </div>

                <p>Migration ƒë∆∞·ª£c t·∫°o ra:</p>

                <div class="code-block">
                    <pre><code><span class="keyword">class</span> <span class="class-name">CreateComments</span> < <span class="class-name">ActiveRecord::Migration</span>[<span class="number">7.0</span>]
<span class="keyword">def</span> <span class="method-name">change</span>
  <span class="method">create_table</span> <span class="symbol">:comments</span> <span class="keyword">do</span> |<span class="variable">t</span>|
    <span class="variable">t</span>.<span class="method">text</span> <span class="symbol">:content</span>
    <span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:post</span>, <span class="symbol">null:</span> <span class="boolean">false</span>, <span class="symbol">foreign_key:</span> <span class="boolean">true</span>
    <span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:user</span>, <span class="symbol">null:</span> <span class="boolean">false</span>, <span class="symbol">foreign_key:</span> <span class="boolean">true</span>

    <span class="variable">t</span>.<span class="method">timestamps</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">AddCategoryToProducts</span> < <span class="class-name">ActiveRecord::Migration</span>[<span class="number">7.0</span>]
<span class="keyword">def</span> <span class="method-name">change</span>
  <span class="method">add_reference</span> <span class="symbol">:products</span>, <span class="symbol">:category</span>, <span class="symbol">foreign_key:</span> <span class="boolean">true</span>
<span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
                </div>

                <h3>5.2. T√πy ch·ªçn Reference</h3>
                <p>C√°c t√πy ch·ªçn ph·ªï bi·∫øn khi t·∫°o reference:</p>

                <div class="code-block">
                    <pre><code><span class="comment"># T·∫°o kh√≥a ngo·∫°i</span>
<span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:user</span>, <span class="symbol">foreign_key:</span> <span class="boolean">true</span>

<span class="comment"># Kh√¥ng cho ph√©p null</span>
<span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:user</span>, <span class="symbol">null:</span> <span class="boolean">false</span>

<span class="comment"># Ch·ªâ ƒë·ªãnh t√™n b·∫£ng tham chi·∫øu</span>
<span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:author</span>, <span class="symbol">foreign_key:</span> { <span class="symbol">to_table:</span> <span class="symbol">:users</span> }

<span class="comment"># Ch·ªâ ƒë·ªãnh h√†nh ƒë·ªông khi x√≥a/c·∫≠p nh·∫≠t</span>
<span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:post</span>, <span class="symbol">foreign_key:</span> { <span class="symbol">on_delete:</span> <span class="symbol">:cascade</span> }

<span class="comment"># T·∫°o index</span>
<span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:user</span>, <span class="symbol">index:</span> <span class="boolean">true</span>

<span class="comment"># Polymorphic reference</span>
<span class="variable">t</span>.<span class="method">references</span> <span class="symbol">:commentable</span>, <span class="symbol">polymorphic:</span> <span class="boolean">true</span></code></pre>
                </div>

                <h3>5.3. S·ª≠ d·ª•ng Reference trong Model</h3>
                <p>Sau khi t·∫°o reference trong migration, b·∫°n c·∫ßn ƒë·ªãnh nghƒ©a m·ªëi quan h·ªá trong model:</p>

                <div class="code-block">
                    <pre><code><span class="keyword">class</span> <span class="class-name">Comment</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">belongs_to</span> <span class="symbol">:post</span>
<span class="method">belongs_to</span> <span class="symbol">:user</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">Post</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">has_many</span> <span class="symbol">:comments</span>
<span class="method">belongs_to</span> <span class="symbol">:user</span>
<span class="keyword">end</span>

<span class="keyword">class</span> <span class="class-name">User</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">has_many</span> <span class="symbol">:posts</span>
<span class="method">has_many</span> <span class="symbol">:comments</span>
<span class="keyword">end</span></code></pre>
                </div>

                <div class="warning">
                    <strong>L∆∞u √Ω:</strong> T·ª´ Rails 5 tr·ªü ƒëi, <code>belongs_to</code> m·∫∑c ƒë·ªãnh y√™u c·∫ßu association ph·∫£i t·ªìn t·∫°i (kh√¥ng ƒë∆∞·ª£c null). B·∫°n c√≥ th·ªÉ thay ƒë·ªïi h√†nh vi n√†y b·∫±ng c√°ch th√™m <code>optional: true</code>.
                </div>
            </div>

            <div class="content-section">
                <h2>6. Th·ª±c h√†nh</h2>
                <p>H√£y th·ª±c h√†nh x√¢y d·ª±ng m·ªôt ·ª©ng d·ª•ng blog ƒë∆°n gi·∫£n v·ªõi c√°c model User, Post, Comment v√† Category.</p>

                <div class="practice-section">
                    <h3>B√†i t·∫≠p: X√¢y d·ª±ng Blog v·ªõi Rails</h3>

                    <div class="step">
                        <div class="step-number">1</div>
                        <p><strong>T·∫°o ·ª©ng d·ª•ng Rails m·ªõi</strong></p>
                        <div class="code-block">
                            <pre><code>rails new blog
cd blog</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">2</div>
                        <p><strong>T·∫°o c√°c model</strong></p>
                        <div class="code-block">
                            <pre><code><span class="comment"># T·∫°o model User</span>
rails g model User name:string email:string:uniq password_digest:string

<span class="comment"># T·∫°o model Category</span>
rails g model Category name:string description:text

<span class="comment"># T·∫°o model Post</span>
rails g model Post title:string content:text published:boolean user:references category:references

<span class="comment"># T·∫°o model Comment</span>
rails g model Comment content:text user:references post:references</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">3</div>
                        <p><strong>Ch·ªânh s·ª≠a c√°c model ƒë·ªÉ th√™m validation v√† association</strong></p>
                        <div class="code-block">
                            <pre><code><span class="comment"># app/models/user.rb</span>
<span class="keyword">class</span> <span class="class-name">User</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">has_many</span> <span class="symbol">:posts</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>
<span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>

<span class="method">validates</span> <span class="symbol">:name</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>
<span class="method">validates</span> <span class="symbol">:email</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>, <span class="symbol">uniqueness:</span> <span class="boolean">true</span>,
                  <span class="symbol">format:</span> { <span class="symbol">with:</span> <span class="regexp">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span> }
<span class="method">has_secure_password</span>
<span class="keyword">end</span>

<span class="comment"># app/models/category.rb</span>
<span class="keyword">class</span> <span class="class-name">Category</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">has_many</span> <span class="symbol">:posts</span>

<span class="method">validates</span> <span class="symbol">:name</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>, <span class="symbol">uniqueness:</span> <span class="boolean">true</span>
<span class="keyword">end</span>

<span class="comment"># app/models/post.rb</span>
<span class="keyword">class</span> <span class="class-name">Post</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">belongs_to</span> <span class="symbol">:user</span>
<span class="method">belongs_to</span> <span class="symbol">:category</span>
<span class="method">has_many</span> <span class="symbol">:comments</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span>

<span class="method">validates</span> <span class="symbol">:title</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>, <span class="symbol">length:</span> { <span class="symbol">minimum:</span> <span class="number">5</span>, <span class="symbol">maximum:</span> <span class="number">100</span> }
<span class="method">validates</span> <span class="symbol">:content</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>

<span class="method">scope</span> <span class="symbol">:published</span>, -> { <span class="method">where</span>(<span class="symbol">published:</span> <span class="boolean">true</span>) }
<span class="method">scope</span> <span class="symbol">:recent</span>, -> { <span class="method">order</span>(<span class="symbol">created_at:</span> <span class="symbol">:desc</span>) }
<span class="keyword">end</span>

<span class="comment"># app/models/comment.rb</span>
<span class="keyword">class</span> <span class="class-name">Comment</span> < <span class="class-name">ApplicationRecord</span>
<span class="method">belongs_to</span> <span class="symbol">:user</span>
<span class="method">belongs_to</span> <span class="symbol">:post</span>

<span class="method">validates</span> <span class="symbol">:content</span>, <span class="symbol">presence:</span> <span class="boolean">true</span>

<span class="method">scope</span> <span class="symbol">:recent</span>, -> { <span class="method">order</span>(<span class="symbol">created_at:</span> <span class="symbol">:desc</span>) }
<span class="keyword">end</span></code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">4</div>
                        <p><strong>Ch·∫°y migration ƒë·ªÉ t·∫°o c∆° s·ªü d·ªØ li·ªáu</strong></p>
                        <div class="code-block">
                            <pre><code>rails db:migrate</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">5</div>
                        <p><strong>T·∫°o d·ªØ li·ªáu m·∫´u v·ªõi seeds.rb</strong></p>
                        <div class="code-block">
                            <pre><code><span class="comment"># db/seeds.rb</span>
<span class="comment"># T·∫°o users</span>
<span class="variable">admin</span> = <span class="class-name">User</span>.<span class="method">create!</span>(<span class="symbol">name:</span> <span class="string">'Admin'</span>, <span class="symbol">email:</span> <span class="string">'admin@example.com'</span>, <span class="symbol">password:</span> <span class="string">'password'</span>)
<span class="variable">john</span> = <span class="class-name">User</span>.<span class="method">create!</span>(<span class="symbol">name:</span> <span class="string">'John Doe'</span>, <span class="symbol">email:</span> <span class="string">'john@example.com'</span>, <span class="symbol">password:</span> <span class="string">'password'</span>)

<span class="comment"># T·∫°o categories</span>
<span class="variable">tech</span> = <span class="class-name">Category</span>.<span class="method">create!</span>(<span class="symbol">name:</span> <span class="string">'Technology'</span>, <span class="symbol">description:</span> <span class="string">'Tech related posts'</span>)
<span class="variable">travel</span> = <span class="class-name">Category</span>.<span class="method">create!</span>(<span class="symbol">name:</span> <span class="string">'Travel'</span>, <span class="symbol">description:</span> <span class="string">'Travel experiences'</span>)

<span class="comment"># T·∫°o posts</span>
<span class="variable">post1</span> = <span class="class-name">Post</span>.<span class="method">create!</span>(
<span class="symbol">title:</span> <span class="string">'Getting Started with Rails'</span>,
<span class="symbol">content:</span> <span class="string">'Rails is a web application framework...'</span>,
<span class="symbol">published:</span> <span class="boolean">true</span>,
<span class="symbol">user:</span> <span class="variable">admin</span>,
<span class="symbol">category:</span> <span class="variable">tech</span>
)

<span class="variable">post2</span> = <span class="class-name">Post</span>.<span class="method">create!</span>(
<span class="symbol">title:</span> <span class="string">'My Trip to Japan'</span>,
<span class="symbol">content:</span> <span class="string">'Japan is an amazing country...'</span>,
<span class="symbol">published:</span> <span class="boolean">true</span>,
<span class="symbol">user:</span> <span class="variable">john</span>,
<span class="symbol">category:</span> <span class="variable">travel</span>
)

<span class="comment"># T·∫°o comments</span>
<span class="class-name">Comment</span>.<span class="method">create!</span>(<span class="symbol">content:</span> <span class="string">'Great post!'</span>, <span class="symbol">user:</span> <span class="variable">john</span>, <span class="symbol">post:</span> <span class="variable">post1</span>)
<span class="class-name">Comment</span>.<span class="method">create!</span>(<span class="symbol">content:</span> <span class="string">'Thanks for sharing'</span>, <span class="symbol">user:</span> <span class="variable">admin</span>, <span class="symbol">post:</span> <span class="variable">post2</span>)</code></pre>
                        </div>
                        <div class="code-block">
                            <pre><code>rails db:seed</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">6</div>
                        <p><strong>Th·ª≠ nghi·ªám v·ªõi Rails Console</strong></p>
                        <div class="code-block">
                            <pre><code>rails console

<span class="comment"># L·∫•y t·∫•t c·∫£ b√†i vi·∫øt ƒë√£ xu·∫•t b·∫£n</span>
<span class="class-name">Post</span>.<span class="method">published</span>

<span class="comment"># L·∫•y b√†i vi·∫øt g·∫ßn ƒë√¢y nh·∫•t</span>
<span class="class-name">Post</span>.<span class="method">recent</span>.<span class="method">first</span>

<span class="comment"># L·∫•y t·∫•t c·∫£ b√†i vi·∫øt c·ªßa m·ªôt ng∆∞·ªùi d√πng</span>
<span class="variable">user</span> = <span class="class-name">User</span>.<span class="method">find_by</span>(<span class="symbol">email:</span> <span class="string">'admin@example.com'</span>)
<span class="variable">user</span>.<span class="variable">posts</span>

<span class="comment"># L·∫•y t·∫•t c·∫£ b√¨nh lu·∫≠n c·ªßa m·ªôt b√†i vi·∫øt</span>
<span class="variable">post</span> = <span class="class-name">Post</span>.<span class="method">first</span>
<span class="variable">post</span>.<span class="variable">comments</span>

<span class="comment"># T·∫°o b√†i vi·∫øt m·ªõi</span>
<span class="variable">category</span> = <span class="class-name">Category</span>.<span class="method">first</span>
<span class="variable">new_post</span> = <span class="variable">user</span>.<span class="variable">posts</span>.<span class="method">build</span>(<span class="symbol">title:</span> <span class="string">'New Post'</span>, <span class="symbol">content:</span> <span class="string">'Content...'</span>, <span class="symbol">category:</span> <span class="variable">category</span>)
<span class="variable">new_post</span>.<span class="method">save</span>

<span class="comment"># Ki·ªÉm tra validation</span>
<span class="variable">invalid_post</span> = <span class="class-name">Post</span>.<span class="method">new</span>
<span class="variable">invalid_post</span>.<span class="method">valid?</span>  <span class="comment"># false</span>
<span class="variable">invalid_post</span>.<span class="variable">errors</span>.<span class="method">full_messages</span>  <span class="comment"># Hi·ªÉn th·ªã l·ªói</span></code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <h3>7. B√†i t·∫≠p th·ª±c h√†nh</h3>

            <div class="content-section">
                <h2>8. T√†i li·ªáu tham kh·∫£o</h2>
                <ul class="reference-links">
                    <li><a href="https://guides.rubyonrails.org/active_record_basics.html" target="_blank" rel="noopener">Rails Guides: Active Record Basics</a></li>
                    <li><a href="https://guides.rubyonrails.org/active_record_migrations.html" target="_blank" rel="noopener">Rails Guides: Active Record Migrations</a></li>
                    <li><a href="https://guides.rubyonrails.org/active_record_validations.html" target="_blank" rel="noopener">Rails Guides: Active Record Validations</a></li>
                    <li><a href="https://guides.rubyonrails.org/association_basics.html" target="_blank" rel="noopener">Rails Guides: Active Record Associations</a></li>
                    <li><a href="https://guides.rubyonrails.org/active_record_querying.html" target="_blank" rel="noopener">Rails Guides: Active Record Query Interface</a></li>
                </ul>
            </div>


            <footer>
                <p>¬© 2025 Ruby on Rails Tutorial - Model & ActiveRecord</p>
            </footer>
